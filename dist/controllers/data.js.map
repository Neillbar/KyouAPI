{"version":3,"sources":["../../src/controllers/data.js"],"names":["mongoose","require","Router","image2base64","attachmentSchema","complaintSchema","fs","module","exports","config","db","api","post","req","res","decodedFile","Buffer","from","body","image","indexOf","split","name","writeFile","err","written","console","log","findOne","complaintID","FindComplaint","status","send","complaintsID","checker","newAtt","type","path","push","imageID","recording","recordingID","video","videoID","save","newentry","updated","get","find","params","findAttachment","length","allData","i","items","toString","convertBase64ToString","object","VideoconvertBase64ToString","RecordingconvertBase64ToString"],"mappings":"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","file":"data.js","sourcesContent":["var mongoose = require('mongoose');\nvar {Router} = require('express');\nconst image2base64 = require('image-to-base64');\nvar attachmentSchema = require('../Schemas/attachmentsSchema');\nvar complaintSchema = require('../Schemas/complaintsSchema');\nconst fs = require('fs');\n\nmodule.exports = ({config,db}) => {\n\n    let api = Router();\n\n\n    api.post('/viaFilesystem',async (req,res) => {\n        let decodedFile = Buffer.from(req.body.image.indexOf('base64') !== -1 ? req.body.image.split('base64,')[1] : req.body.image, 'base64');\n        name = req.body.name;\n        fs.writeFile(`./images/${name}`, decodedFile, function(err,written){\n        if(err) console.log(err);\n         else {\n          console.log(\"Successfully written\");\n         }\n     });\n\n    })\n\n\n\n\napi.post('/attachment',async (req,res) => {\n\nlet FindComplaint = await complaintSchema.findOne({complaintID: req.body.complaintID});\n\nif(!FindComplaint){\n    return res.status(400).send(\"No complaints found can't add attachments\");\n}\n\n\n\n// //take base64 to Buffer\n\nlet checker = await attachmentSchema.findOne({complaintsID: req.body.complaintID});\n\nif(!checker){\n    var newAtt = new attachmentSchema();\n    newAtt.complaintsID = req.body.complaintID;\n    \n    if (req.body.type == \"image\"){\n        //let decodedImage = Buffer.from(req.body.image.indexOf('base64') !== -1 ? req.body.image.split('base64,')[1] : req.body.image, 'base64');\n        newAtt.image.path.push(req.body.image);\n        newAtt.image.imageID.push(req.body.imageID);\n    }\n    \n    if(req.body.type == \"recording\"){\n    \n       // let decodedRecording = Buffer.from(req.body.recording.indexOf('base64') !== -1 ? req.body.recording.split('base64,')[1] : req.body.recording, 'base64');\n        newAtt.recording = req.body.recording;\n        newAtt.recordingID = req.body.recordingID;\n    }\n    if(req.body.type == \"video\"){\n    \n        //let decodedVideo = Buffer.from(req.body.video.indexOf('base64') !== -1 ? req.body.video.split('base64,')[1] : req.body.video, 'base64');\n        newAtt.video = req.body.video;\n        newAtt.videoID = req.body.videoID;\n    }\n    \n    \n    let newentry = await newAtt.save();\n    if(newentry){\n        res.send(newentry);\n    }\n    \n}else{\n\n    if (req.body.type == \"image\"){\n       // let decodedImage = Buffer.from(req.body.image.indexOf('base64') !== -1 ? req.body.image.split('base64,')[1] : req.body.image, 'base64');\n        checker.image.path.push(req.body.image);\n        newAtt.image.imageID.push(req.body.imageID);\n    }\n    \n    if(req.body.type == \"recording\"){\n    \n        //let decodedRecording = Buffer.from(req.body.recording.indexOf('base64') !== -1 ? req.body.recording.split('base64,')[1] : req.body.recording, 'base64');\n        checker.recording = req.body.recording;\n        checker.recordingID = req.body.recordingID;\n    }\n    if(req.body.type == \"video\"){\n    \n       // let decodedVideo = Buffer.from(req.body.video.indexOf('base64') !== -1 ? req.body.video.split('base64,')[1] : req.body.video, 'base64');\n        checker.video = req.body.video;\n        checker.videoID = req.body.videoID;\n    }\n\nlet updated = await checker.save();\nif(updated){\n    res.send(updated);\n}\n\n\n}\n\n\n})\n\napi.get('/getByName/:complaintID', async (req,res) => {\n\n    let findAttachment = await attachmentSchema.find({complaintsID:req.params.complaintID});\n\n    if(findAttachment.length < 1){\n\n        return res.status(400).send(\"Could not find attachments\");\n    }\n\n\n\nlet allData = [];\nvar i = 0;\n//console.log(findAttachment[0].image.length);\nif(findAttachment[0].image){\n\nfor(var items in  findAttachment[0].image){\n    let name = findAttachment[0].complaintsID;\n   let convertBase64ToString = await findAttachment[0].image[items].toString('base64');\n\nlet object = {complaintsID:name,image:convertBase64ToString };\nallData.push(object);\n}\n}\n\nif(findAttachment[0].video){\n    let name = findAttachment[0].complaintsID;\n\n    let VideoconvertBase64ToString = await findAttachment[0].video.toString('base64');\n    let object = {complaintsID:name,video:VideoconvertBase64ToString};\n    allData.push(object);\n}\n\nif(findAttachment[0].recording){\n    let name = findAttachment[0].complaintsID;\n\n    let RecordingconvertBase64ToString = await findAttachment[0].video.toString('base64');\n    let object = {complaintsID:name,recording:RecordingconvertBase64ToString};\n    allData.push(object);\n\n}\n\n\n//console.log(allData[0]);\n\n//console.log(findAttachment[0].image[1].toString('base64'));\n\nreturn res.send(allData);\n\n\n\n})\n\n    return api;\n\n}"]}